<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>14 Hierarchical Roles 3.0.0.M1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/newInV3.html"><strong>2</strong><span>What's New in Version 3.0</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/newInV2.html"><strong>3</strong><span>What's New in Version 2.0</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClasses.html"><strong>4</strong><span>Domain Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/requestMappings.html"><strong>5</strong><span>Configuring Request Mappings to Secure URLs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/helperClasses.html"><strong>6</strong><span>Helper Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/events.html"><strong>7</strong><span>Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClassProperties.html"><strong>8</strong><span>User, Authority (Role), and Requestmap Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authentication.html"><strong>9</strong><span>Authentication</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authenticationProviders.html"><strong>10</strong><span>Authentication Providers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/userDetailsService.html"><strong>11</strong><span>Custom UserDetailsService</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/passwords.html"><strong>12</strong><span>Password and Account Protection</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/urlProperties.html"><strong>13</strong><span>URL Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/hierarchicalRoles.html"><strong>14</strong><span>Hierarchical Roles</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/switchUser.html"><strong>15</strong><span>Switch User</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/filters.html"><strong>16</strong><span>Filters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/channelSecurity.html"><strong>17</strong><span>Channel Security</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/ip.html"><strong>18</strong><span>IP Address Restrictions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/sessionFixation.html"><strong>19</strong><span>Session Fixation Prevention</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/logoutHandlers.html"><strong>20</strong><span>Logout Handlers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/voters.html"><strong>21</strong><span>Voters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/miscProperties.html"><strong>22</strong><span>Miscellaneous Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/tutorials.html"><strong>23</strong><span>Tutorials</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/controllerMetaClassMethods.html"><strong>24</strong><span>Controller MetaClass Methods</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/i18n.html"><strong>25</strong><span>Internationalization</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p></p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/urlProperties.html">&lt;&lt; <strong>13</strong><span>URL Properties</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/switchUser.html"><strong>15</strong><span>Switch User</span> >></a></div>
                


                <div class="project">
                    <h1>14 Hierarchical Roles - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith, Beverley Talbott</p>

                    <p><strong>Version:</strong> 3.0.0.M1</p>

                    
                </div>

                

                

<h1 id="hierarchicalRoles">14 Hierarchical Roles</h1>
Hierarchical roles are a convenient way to reduce clutter in your request mappings.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>roleHierarchy</td><td>none</td><td>Hierarchical role definition.</td></tr><tr class="table-even"><td>roleHierarchyEntryClassName</td><td>none</td><td>Domain class used to manage persistent role hierarchy entries</td></tr></table><p class="paragraph"/>For example, if you have several types of 'admin' roles that can be used to access a URL pattern and you do not use hierarchical roles, you need to specify all the admin roles:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.annotation.Secured<p class="paragraph"/>class SomeController &#123;<p class="paragraph"/>   @Secured(&#91;'ROLE_ADMIN', 'ROLE_FINANCE_ADMIN', 'ROLE_SUPERADMIN'&#93;)
   def someAction() &#123;
      &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/>However, if you have a business rule that says <code>ROLE_FINANCE_ADMIN</code> implies being granted <code>ROLE_ADMIN</code>, and that <code>ROLE_SUPERADMIN</code> implies being granted <code>ROLE_FINANCE_ADMIN</code>, you can express that hierarchy as:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.roleHierarchy = '''
   ROLE_SUPERADMIN &#62; ROLE_FINANCE_ADMIN
   ROLE_FINANCE_ADMIN &#62; ROLE_ADMIN
'''</pre></div><p class="paragraph"/>Then you can simplify your mappings by specifying only the roles that are required:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.annotation.Secured<p class="paragraph"/>class SomeController &#123;<p class="paragraph"/>   @Secured(&#91;'ROLE_ADMIN'&#93;)
   def someAction() &#123;
      &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/>You can also reduce the number of granted roles in the database. Where previously you had to grant <code>ROLE_SUPERADMIN</code>, <code>ROLE_FINANCE_ADMIN</code>, and <code>ROLE_ADMIN</code>, now you only need to grant <code>ROLE_SUPERADMIN</code>.<p class="paragraph"/><h4>Persistent role hierarchy</h4><p class="paragraph"/>Specifying a static string in the <code>roleHierarchy</code> property will be sufficient for most applications, but you can also store the information in your database. This is particularly useful if you're also storing requestmaps in the database. To use persistant storage, run the <a href="../ref/Scripts/s2-create-role-hierarchy-entry.html" class="Scripts">s2-create-role-hierarchy-entry</a> script. This will create the domain class and enable persistent storage by registering its name as the <code>roleHierarchyEntryClassName</code> setting in <code>grails-app/conf/application.groovy</code>.<p class="paragraph"/>For example, running<p class="paragraph"/><div class="code"><pre>$ grails s2&#45;create&#45;role&#45;hierarchy&#45;entry com.yourapp.RoleHierarchyEntry</pre></div><p class="paragraph"/>will generate this class in <code>grails-app/domain/com/yourapp/RoleHierarchyEntry.groovy</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourapp<p class="paragraph"/>class RoleHierarchyEntry <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>   <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> <span class="java&#45;object">long</span> serialVersionUID = 1<p class="paragraph"/>   <span class="java&#45;object">String</span> entry<p class="paragraph"/>   RoleHierarchyEntry(<span class="java&#45;object">String</span> entry) &#123;
      <span class="java&#45;keyword">this</span>()
      <span class="java&#45;keyword">this</span>.entry = entry
   &#125;<p class="paragraph"/>   @Override
   <span class="java&#45;object">int</span> hashCode() &#123;
      entry?.hashCode() ?: 0
   &#125;<p class="paragraph"/>   @Override
   <span class="java&#45;object">boolean</span> equals(other) &#123;
      is(other) || (other <span class="java&#45;keyword">instanceof</span> RoleHierarchyEntry &#38;&#38; other.entry == entry)
   &#125;<p class="paragraph"/>   @Override
   <span class="java&#45;object">String</span> toString() &#123;
      entry
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      entry blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      cache <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/>To store the equivalent entries for the ROLE_SUPERADMIN / ROLE_FINANCE_ADMIN / ROLE_ADMIN hierarchy, add code like this to a method in a transactional service:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span> (!RoleHierarchyEntry.count()) &#123;
   <span class="java&#45;keyword">new</span> RoleHierarchyEntry('ROLE_SUPERADMIN &#62; ROLE_FINANCE_ADMIN').save()
   <span class="java&#45;keyword">new</span> RoleHierarchyEntry('ROLE_FINANCE_ADMIN &#62; ROLE_ADMIN').save()
&#125;</pre></div>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/urlProperties.html">&lt;&lt; <strong>13</strong><span>URL Properties</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/switchUser.html"><strong>15</strong><span>Switch User</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-create-persistent-token.html">s2-create-persistent-token</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-create-role-hierarchy-entry.html">s2-create-role-hierarchy-entry</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-quickstart.html">s2-quickstart</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
