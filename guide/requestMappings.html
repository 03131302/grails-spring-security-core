<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Configuring Request Mappings to Secure URLs 2.0-RC5</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/newInV2.html"><strong>2</strong><span>What's New in Version 2.0</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClasses.html"><strong>3</strong><span>Domain Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/requestMappings.html"><strong>4</strong><span>Configuring Request Mappings to Secure URLs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/helperClasses.html"><strong>5</strong><span>Helper Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/events.html"><strong>6</strong><span>Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClassProperties.html"><strong>7</strong><span>User, Authority (Role), and Requestmap Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authentication.html"><strong>8</strong><span>Authentication</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authenticationProviders.html"><strong>9</strong><span>Authentication Providers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/userDetailsService.html"><strong>10</strong><span>Custom UserDetailsService</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/passwords.html"><strong>11</strong><span>Password and Account Protection</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/urlProperties.html"><strong>12</strong><span>URL Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/hierarchicalRoles.html"><strong>13</strong><span>Hierarchical Roles</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/switchUser.html"><strong>14</strong><span>Switch User</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/filters.html"><strong>15</strong><span>Filters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/channelSecurity.html"><strong>16</strong><span>Channel Security</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/ip.html"><strong>17</strong><span>IP Address Restrictions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/sessionFixation.html"><strong>18</strong><span>Session Fixation Prevention</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/logoutHandlers.html"><strong>19</strong><span>Logout Handlers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/voters.html"><strong>20</strong><span>Voters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/miscProperties.html"><strong>21</strong><span>Miscellaneous Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/tutorials.html"><strong>22</strong><span>Tutorials</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/controllerMetaClassMethods.html"><strong>23</strong><span>Controller MetaClass Methods</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/i18n.html"><strong>24</strong><span>Internationalization</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Spring Security Core plugin</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/domainClasses.html">&lt;&lt; <strong>3</strong><span>Domain Classes</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/helperClasses.html"><strong>5</strong><span>Helper Classes</span> >></a></div>
                


                <div class="project">
                    <h1>4 Configuring Request Mappings to Secure URLs - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith, Beverley Talbott</p>

                    <p><strong>Version:</strong> 2.0-RC5</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#securedAnnotations"><strong>4.1</strong><span>Defining Secured Annotations</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#configGroovyMap"><strong>4.2</strong><span>Simple Map in Config.groovy</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#requestmapInstances"><strong>4.3</strong><span>Requestmap Instances Stored in the Database</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#expressions"><strong>4.4</strong><span>Using Expressions to Create Descriptive, Fine-Grained Rules</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="requestMappings">4 Configuring Request Mappings to Secure URLs</h1>
You can choose among the following approaches to configuring request mappings for secure application URLs. The goal is to map URL patterns to the roles required to access those URLs.
<ul class="star">
<li><a href="../guide/single.html#securedAnnotations" class="guide"><code>@Secured</code> annotations (default approach)</a></li>
<li><a href="../guide/single.html#configGroovyMap" class="guide">A simple Map in <code>Config.groovy</code></a></li>
<li><a href="../guide/single.html#requestmapInstances" class="guide"><code>Requestmap</code> domain class instances stored in the database</a></li>
</ul><p class="paragraph"/>You can only use one method at a time. You configure it with the <code>securityConfigType</code> attribute; the value has to be an <code>SecurityConfigType</code> enum value or the name of the enum as a String.<p class="paragraph"/><h4>Pessimistic Lockdown</h4><p class="paragraph"/>Many applications are mostly public, with some pages only accessible to authenticated users with various roles. In this case, it might make sense to leave URLs open by default and restrict access on a case-by-case basis. However, if your application is primarily secure, you can use a pessimistic lockdown approach to deny access to all URLs that do not have an applicable URL-Role request mapping. But the pessimistic approach is safer; if you forget to restrict access to a URL using the optimistic approach, it might take a while to discover that unauthorized users can access the URL, but if you forget to allow access when using the pessimistic approach, no user can access it and the error should be quickly discovered.<p class="paragraph"/>The pessimistic approach is the default, and there are two configuration options that apply. If <code>rejectIfNoRule</code> is <code>true</code> (the default) then any URL that has no request mappings (an annotation, entry in <code>controllerAnnotations.staticRules</code> or <code>interceptUrlMap</code>, or a <code>Requestmap</code> instance) will be denied to all users. The other option is <code>fii.rejectPublicInvocations</code> and if it is <code>true</code> (the default) then un-mapped URLs will trigger an <code>IllegalArgumentException</code> and will show the error page. This is uglier, but more useful because it's very clear that there is a misconfiguration. When <code>fii.rejectPublicInvocations</code> is <code>false</code> but <code>rejectIfNoRule</code> is <code>true</code> you just see the "Sorry, you're not authorized to view this page." error 403 message.<p class="paragraph"/>Note that the two settings are mutually exclusive. If <code>rejectIfNoRule</code> is <code>true</code> then <code>fii.rejectPublicInvocations</code> is ignored because the request will transition to the login page or the error 403 page. If you want the more obvious error page, set <code>fii.rejectPublicInvocations</code> to <code>true</code> and <code>rejectIfNoRule</code> to <code>false</code> to allow that check to occur.<p class="paragraph"/>To reject un-mapped URLs with a 403 error code, use these settings (or none since <code>rejectIfNoRule</code> defaults to <code>true</code> )<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.rejectIfNoRule = <span class="java&#45;keyword">true</span>
grails.plugin.springsecurity.fii.rejectPublicInvocations = <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/>and to reject with the error 500 page, use these (optionally omit <code>rejectPublicInvocations</code> since it defaults to <code>true</code> ):<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.rejectIfNoRule = <span class="java&#45;keyword">false</span>
grails.plugin.springsecurity.fii.rejectPublicInvocations = <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/>Note that if you set <code>rejectIfNoRule</code> or <code>rejectPublicInvocations</code> to <code>true</code> you'll need to configure the <code>staticRules</code> map to include URLs that can't otherwise be guarded:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.controllerAnnotations.staticRules = &#91;
   '/':               &#91;'permitAll'&#93;,
   '/index':          &#91;'permitAll'&#93;,
   '/index.gsp':      &#91;'permitAll'&#93;,
   '/assets/&#42;&#42;':      &#91;'permitAll'&#93;,
   '/&#42;&#42;/js/&#42;&#42;':       &#91;'permitAll'&#93;,
   '/&#42;&#42;/css/&#42;&#42;':      &#91;'permitAll'&#93;,
   '/&#42;&#42;/images/&#42;&#42;':   &#91;'permitAll'&#93;,
   '/&#42;&#42;/favicon.ico': &#91;'permitAll'&#93;
&#93;</pre></div><p class="paragraph"/>This is needed when using annotations; if you use the <code>grails.plugin.springsecurity.interceptUrlMap</code> map in <code>Config.groovy</code> you'll need to add these URLs too, and likewise when using <code>Requestmap</code> instances. If you don't use annotations, you must add rules for the login and logout controllers also. You can add Requestmaps manually, or in BootStrap.groovy, for example:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (<span class="java&#45;object">String</span> url in &#91;
      '/', '/index', '/index.gsp', '/&#42;&#42;/favicon.ico',
      '/&#42;&#42;/js/&#42;&#42;', '/&#42;&#42;/css/&#42;&#42;', '/&#42;&#42;/images/&#42;&#42;',
      '/login', '/login.&#42;', '/login/&#42;',
      '/logout', '/logout.&#42;', '/logout/&#42;'&#93;) &#123;
   <span class="java&#45;keyword">new</span> Requestmap(url: url, configAttribute: 'permitAll').save()
&#125;</pre></div><p class="paragraph"/>The analogous interceptUrlMap settings would be:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.interceptUrlMap = &#91;
   '/':                &#91;'permitAll'&#93;,
   '/index':           &#91;'permitAll'&#93;,
   '/index.gsp':       &#91;'permitAll'&#93;,
   '/assets/&#42;&#42;':       &#91;'permitAll'&#93;,
   '/&#42;&#42;/js/&#42;&#42;':        &#91;'permitAll'&#93;,
   '/&#42;&#42;/css/&#42;&#42;':       &#91;'permitAll'&#93;,
   '/&#42;&#42;/images/&#42;&#42;':    &#91;'permitAll'&#93;,
   '/&#42;&#42;/favicon.ico':  &#91;'permitAll'&#93;,
   '/login/&#42;&#42;':        &#91;'permitAll'&#93;,
   '/logout/&#42;&#42;':       &#91;'permitAll'&#93;
&#93;</pre></div><p class="paragraph"/>In addition, when you enable the switch-user feature, you'll have to specify access rules for the associated URLs, e.g.<p class="paragraph"/><div class="code"><pre>'/j_spring_security_switch_user': &#91;'ROLE_ADMIN'&#93;,
'/j_spring_security_exit_user':   &#91;'permitAll'&#93;</pre></div><p class="paragraph"/><h4>URLs and Authorities</h4><p class="paragraph"/>In each approach you configure a mapping for a URL pattern to the role(s) that are required to access those URLs, for example, <code>/admin/user/&#42;&#42;</code> requires <code>ROLE_ADMIN</code>. In addition, you can combine the role(s) with tokens such as IS_AUTHENTICATED_ANONYMOUSLY, IS_AUTHENTICATED_REMEMBERED, and IS_AUTHENTICATED_FULLY. One or more <a href="../guide/single.html#voters" class="guide">Voter</a>s will process any tokens and enforce a rule based on them:
<ul class="star">
<li><code>IS_AUTHENTICATED_ANONYMOUSLY</code></li>
<ul class="star">
<li>signifies that anyone can access this URL. By default the <code>AnonymousAuthenticationFilter</code> ensures an 'anonymous' <code>Authentication</code> with no roles so that every user has an authentication. The token accepts any authentication, even anonymous.</li>
</ul>
<li><code>IS_AUTHENTICATED_REMEMBERED</code></li>
<ul class="star">
<li>requires the user to be authenticated through a remember-me cookie or an explicit login.</li>
</ul>
<li><code>IS_AUTHENTICATED_FULLY</code></li>
<ul class="star">
<li>requires the user to be fully authenticated with an explicit login.</li>
</ul></ul><p class="paragraph"/>With <code>IS_AUTHENTICATED_FULLY</code> you can implement a security scheme whereby users can check a remember-me checkbox during login and be auto-authenticated each time they return to your site, but must still log in with a password for some parts of the site. For example, allow regular browsing and adding items to a shopping cart with only a cookie, but require an explicit login to check out or view purchase history.<p class="paragraph"/>For more information on <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code>, see the Javadoc for <a href="https://docs.spring.io/spring-security/site/docs/3.2.x/apidocs/org/springframework/security/access/vote/AuthenticatedVoter.html" target="blank">AuthenticatedVoter</a><p class="paragraph"/><blockquote class="warning">
The plugin isn't compatible with Grails <code>&#60;g:actionSubmit&#62;</code> tags. These are used in the autogenerated GSPs that are created for you, and they enable having multiple submit buttons, each with its own action, inside a single form. The problem from the security perspective is that the form posts to the default action of the controller, and Grails figures out the handler action to use based on the <code>action</code> attribute of the <code>actionSubmit</code> tag. So for example you can guard the <code>/person/delete</code> with a restrictive role, but given this typical edit form:<p class="paragraph"/><div class="code"><pre>&#60;g:form&#62;
   &#8230;
   &#60;g:actionSubmit class=<span class="java&#45;quote">"save"</span> action=<span class="java&#45;quote">"update"</span>
                   value='Update' /&#62;<p class="paragraph"/>   &#60;g:actionSubmit class=<span class="java&#45;quote">"delete"</span> action=<span class="java&#45;quote">"delete"</span>
                   value="'Delete' /&#62;
&#60;/g:form&#62;</pre></div><p class="paragraph"/>both actions will be allowed if the user has permission to access the <code>/person/index</code> url, which would often be the case.<p class="paragraph"/>The workaround is to create separate forms without using <code>actionSubmit</code> and explicitly set the <code>action</code> on the <code>&#60;g:form&#62;</code> tags, which will result in form submissions to the expected urls and properly guarded urls.
</blockquote><p class="paragraph"/><h4>Comparing the Approaches</h4><p class="paragraph"/>Each approach has its advantages and disadvantages. Annotations and the <code>Config.groovy</code> Map are less flexible because they are configured once in the code and you can update them only by restarting the application (in prod mode anyway). In practice this limitation is minor, because security mappings for most applications are unlikely to change at runtime.<p class="paragraph"/>On the other hand, storing <code>Requestmap</code> entries enables runtime-configurability. This approach gives you a core set of rules populated at application startup that you can edit, add to, and delete as needed. However, it separates the security rules from the application code, which is less convenient than having the rules defined in <code>grails-app/conf/Config.groovy</code> or in the applicable controllers using annotations.<p class="paragraph"/>URLs must be mapped in lowercase if you use the <code>Requestmap</code> or <code>grails-app/conf/Config.groovy</code> map approaches. For example, if you have a FooBarController, its urls will be of the form /fooBar/list, /fooBar/create, and so on, but these must be mapped as /foobar/, /foobar/list, /foobar/create. This mapping is handled automatically for you if you use annotations.



<h2 id="securedAnnotations">4.1 Defining Secured Annotations</h2>
You can use an <code>&#64;Secured</code> annotation (either the standard <code>org.springframework.security.access.annotation.Secured</code> or the plugin's <code>grails.plugin.springsecurity.annotation.Secured</code> which also works on controller closure actions) in your controllers to configure which roles are required for which actions. To use annotations, specify <code>securityConfigType="Annotation"</code>, or leave it unspecified because it's the default:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.securityConfigType = <span class="java&#45;quote">"Annotation"</span></pre></div><p class="paragraph"/>You can define the annotation at the class level, meaning that the specified roles are required for all actions, or at the action level, or both. If the class and an action are annotated then the action annotation values will be used since they're more specific.<p class="paragraph"/>For example, given this controller:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.annotation.Secured<p class="paragraph"/>class SecureAnnotatedController &#123;<p class="paragraph"/>   @Secured(&#91;'ROLE_ADMIN'&#93;)
   def index() &#123;
      render 'you have ROLE_ADMIN'
   &#125;<p class="paragraph"/>   @Secured(&#91;'ROLE_ADMIN', 'ROLE_SUPERUSER'&#93;)
   def adminEither() &#123;
      render 'you have ROLE_ADMIN or SUPERUSER'
   &#125;<p class="paragraph"/>   def anybody() &#123;
      render 'anyone can see <span class="java&#45;keyword">this</span>' // assuming you're not using <span class="java&#45;quote">"strict"</span> mode
   &#125;
&#125;</pre></div><p class="paragraph"/>you must be authenticated and have <code>ROLE_ADMIN</code> to see <code>/myapp/secureAnnotated</code> (or <code>/myapp/secureAnnotated/index</code>) and be authenticated and have <code>ROLE_ADMIN</code> or <code>ROLE_SUPERUSER</code> to see <code>/myapp/secureAnnotated/adminEither</code>. Any user can access <code>/myapp/secureAnnotated/anybody</code> if you have disabled "strict" mode (using <code>rejectIfNoRule</code>), and nobody can access the action by default since it has no access rule configured.<p class="paragraph"/>In addition, you can define a closure in the annotation which will be called during access checking. The closure must return <code>true</code> or <code>false</code> and has all of the methods and properties that are available when using SpEL expressions, since the closure's <code>delegate</code> is set to a subclass of <code>WebSecurityExpressionRoot</code>, and also the Spring <code>ApplicationContext</code> as the <code>ctx</code> property:<p class="paragraph"/><div class="code"><pre>@Secured(closure = &#123;
   assert request
   assert ctx
   authentication.name == 'admin1'
&#125;)
def someMethod() &#123;
   &#8230;
&#125;</pre></div><p class="paragraph"/>Often most actions in a controller require similar access rules, so you can also define annotations at the class level:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.annotation.Secured<p class="paragraph"/>@Secured(&#91;'ROLE_ADMIN'&#93;)
class SecureClassAnnotatedController &#123;<p class="paragraph"/>   def index() &#123;
      render 'index: you have ROLE_ADMIN'
   &#125;<p class="paragraph"/>   def otherAction() &#123;
      render 'otherAction: you have ROLE_ADMIN'
   &#125;<p class="paragraph"/>   @Secured(&#91;'ROLE_SUPERUSER'&#93;)
   def <span class="java&#45;keyword">super</span>() &#123;
      render '<span class="java&#45;keyword">super</span>: you have ROLE_SUPERUSER'
   &#125;
&#125;</pre></div><p class="paragraph"/>Here you need to be authenticated and have <code>ROLE_ADMIN</code> to see <code>/myapp/secureClassAnnotated</code> (or <code>/myapp/secureClassAnnotated/index</code>) or <code>/myapp/secureClassAnnotated/otherAction</code>. However, you must have <code>ROLE_SUPERUSER</code> to access <code>/myapp/secureClassAnnotated/super</code>. The action-scope annotation overrides the class-scope annotation. Note that "strict" mode isn't applicable here since all actions have an access rule defined (either explicitly or inherited from the class-level annotation).<p class="paragraph"/><h4>controllerAnnotations.staticRules</h4><p class="paragraph"/>You can also define 'static' mappings that cannot be expressed in the controllers, such as '/&#42;&#42;' or for JavaScript, CSS, or image URLs. Use the <code>controllerAnnotations.staticRules</code> property, for example:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.controllerAnnotations.staticRules = &#91;
   &#8230;
   '/js/admin/&#42;&#42;': &#91;'ROLE_ADMIN'&#93;,
   '/someplugin/&#42;&#42;': &#91;'ROLE_ADMIN'&#93;
&#93;</pre></div><p class="paragraph"/>This example maps all URLs associated with <code>SomePluginController</code>, which has URLs of the form <code>/somePlugin/...</code>, to <code>ROLE_ADMIN</code>; annotations are not an option here because you would not edit plugin code for a change like this.<p class="paragraph"/><blockquote class="note">
When mapping URLs for controllers that are mapped in <code>UrlMappings.groovy</code>, you need to secure the un-url-mapped URLs. For example if you have a FooBarController that you map to <code>/foo/bar/$action</code>, you must register that in <code>controllerAnnotations.staticRules</code> as <code>/foobar/&#42;&#42;</code>. This is different than the mapping you would use for the other two approaches and is necessary because <code>controllerAnnotations.staticRules</code> entries are treated as if they were annotations on the corresponding controller.
</blockquote>



<h2 id="configGroovyMap">4.2 Simple Map in Config.groovy</h2>
To use the <code>Config.groovy</code> Map to secure URLs, first specify <code>securityConfigType="InterceptUrlMap"</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.securityConfigType = <span class="java&#45;quote">"InterceptUrlMap"</span></pre></div><p class="paragraph"/>Define a Map in <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.interceptUrlMap = &#91;
   '/':                &#91;'permitAll'&#93;,
   '/index':           &#91;'permitAll'&#93;,
   '/index.gsp':       &#91;'permitAll'&#93;,
   '/assets/&#42;&#42;':       &#91;'permitAll'&#93;,
   '/&#42;&#42;/js/&#42;&#42;':        &#91;'permitAll'&#93;,
   '/&#42;&#42;/css/&#42;&#42;':       &#91;'permitAll'&#93;,
   '/&#42;&#42;/images/&#42;&#42;':    &#91;'permitAll'&#93;,
   '/&#42;&#42;/favicon.ico':  &#91;'permitAll'&#93;,
   '/login/&#42;&#42;':        &#91;'permitAll'&#93;,
   '/logout/&#42;&#42;':       &#91;'permitAll'&#93;,
   '/secure/&#42;&#42;':       &#91;'ROLE_ADMIN'&#93;,
   '/finance/&#42;&#42;':      &#91;'ROLE_FINANCE', 'isFullyAuthenticated()'&#93;,
&#93;</pre></div><p class="paragraph"/>When using this approach, make sure that you order the rules correctly. The first applicable rule is used, so for example if you have a controller that has one set of rules but an action that has stricter access rules, e.g.<p class="paragraph"/><div class="code"><pre>'/secure/&#42;&#42;':              &#91;'ROLE_ADMIN', 'ROLE_SUPERUSER'&#93;,
'/secure/reallysecure/&#42;&#42;': &#91;'ROLE_SUPERUSER'&#93;</pre></div><p class="paragraph"/>then this would fail - it wouldn't restrict access to <code>/secure/reallysecure/list</code> to a user with <code>ROLE_SUPERUSER</code> since the first URL pattern matches, so the second would be ignored. The correct mapping would be<p class="paragraph"/><div class="code"><pre>'/secure/reallysecure/&#42;&#42;': &#91;'ROLE_SUPERUSER'&#93;
'/secure/&#42;&#42;':              &#91;'ROLE_ADMIN', 'ROLE_SUPERUSER'&#93;,</pre></div>



<h2 id="requestmapInstances">4.3 Requestmap Instances Stored in the Database</h2>
With this approach you use the <code>Requestmap</code> domain class to store mapping entries in the database. <code>Requestmap</code> has a <code>url</code> property that contains the secured URL pattern and a <code>configAttribute</code> property containing a comma-delimited list of required roles and/or tokens such as <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code>.<p class="paragraph"/>To use <code>Requestmap</code> entries, specify <code>securityConfigType="Requestmap"</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.securityConfigType = <span class="java&#45;quote">"Requestmap"</span></pre></div><p class="paragraph"/>You create <code>Requestmap</code> entries as you create entries in any Grails domain class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (<span class="java&#45;object">String</span> url in &#91;
      '/', '/index', '/index.gsp', '/&#42;&#42;/favicon.ico',
      '/assets/&#42;&#42;', '/&#42;&#42;/js/&#42;&#42;', '/&#42;&#42;/css/&#42;&#42;', '/&#42;&#42;/images/&#42;&#42;',
      '/login', '/login.&#42;', '/login/&#42;',
      '/logout', '/logout.&#42;', '/logout/&#42;'&#93;) &#123;
   <span class="java&#45;keyword">new</span> Requestmap(url: url, configAttribute: 'permitAll').save()
&#125;<p class="paragraph"/><span class="java&#45;keyword">new</span> Requestmap(url: '/profile/&#42;&#42;',    configAttribute: 'ROLE_USER').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/admin/&#42;&#42;',      configAttribute: 'ROLE_ADMIN').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/admin/role/&#42;&#42;', configAttribute: 'ROLE_SUPERVISOR').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/admin/user/&#42;&#42;', configAttribute: 'ROLE_ADMIN,ROLE_SUPERVISOR').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/j_spring_security_switch_user',
               configAttribute: 'ROLE_SWITCH_USER,isFullyAuthenticated()').save()</pre></div><p class="paragraph"/>The <code>configAttribute</code> value can have a single value or have multiple comma-delimited values. In this example only users with <code>ROLE_ADMIN</code> or <code>ROLE_SUPERVISOR</code> can access <code>/admin/user/&#42;&#42;</code> urls, and only users with <code>ROLE_SWITCH_USER</code> can access the switch-user url (<code>/j_spring_security_switch_user</code>) and in addition must be authenticated fully, i.e. not using a remember-me cookie. Note that when specifying multiple roles, the user must have at least one of them, but when combining <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, or <code>IS_AUTHENTICATED_ANONYMOUSLY</code> (or their corresponding SpEL expressions) with one or more roles means the user must have one of the roles and satisty the <code>IS_AUTHENTICATED</code> rule.<p class="paragraph"/>Unlike the <a href="../guide/single.html#configGroovyMap" class="guide">Config.groovy Map approach</a>, you do not need to revise the <code>Requestmap</code> entry order because the plugin calculates the most specific rule that applies to the current request.<p class="paragraph"/><h4>Requestmap Cache</h4><p class="paragraph"/><code>Requestmap</code> entries are cached for performance, but caching affects runtime configurability. If you create, edit, or delete an instance, the cache must be flushed and repopulated to be consistent with the database. You can call <code>springSecurityService.clearCachedRequestmaps()</code> to do this. For example, if you create a <code>RequestmapController</code> the <code>save</code> action should look like this (and the update and delete actions should similarly call <code>clearCachedRequestmaps()</code>):<p class="paragraph"/><div class="code"><pre>class RequestmapController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   ...<p class="paragraph"/>   def save() &#123;
      def requestmapInstance = <span class="java&#45;keyword">new</span> Requestmap(params)
      <span class="java&#45;keyword">if</span> (!requestmapInstance.save(flush: <span class="java&#45;keyword">true</span>)) &#123;
         render view: 'create', model: &#91;requestmapInstance: requestmapInstance&#93;
         <span class="java&#45;keyword">return</span>
      &#125;<p class="paragraph"/>      springSecurityService.clearCachedRequestmaps()<p class="paragraph"/>      flash.message = <span class="java&#45;quote">"$&#123;message(code: '<span class="java&#45;keyword">default</span>.created.message', args: &#91;message(code: 'requestmap.label', <span class="java&#45;keyword">default</span>: 'Requestmap'), requestmapInstance.id&#93;)&#125;"</span>
      redirect action: 'show', id: requestmapInstance.id
   &#125;
&#125;</pre></div>



<h2 id="expressions">4.4 Using Expressions to Create Descriptive, Fine-Grained Rules</h2>
Spring Security uses the <a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/expressions.html" target="blank">Spring Expression Language (SpEL)</a>, which allows you to declare the rules for guarding URLs more descriptively than does the traditional approach, and also allows much more fine-grained rules. Where you traditionally would specify a list of role names and/or special tokens (for example, <code>IS_AUTHENTICATED_FULLY</code>), with <a href="https://docs.spring.io/spring-security/site/docs/3.2.x/reference/htmlsingle/#el-access" target="blank">Spring Security&#39;s expression support</a>, you can instead use the embedded scripting language to define simple or complex access rules.<p class="paragraph"/>You can use expressions with any of the previously described approaches to securing application URLs. For example, consider this annotated controller:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourcompany.yourapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.annotation.Secured<p class="paragraph"/>class SecureController &#123;<p class="paragraph"/>   @Secured(&#91;<span class="java&#45;quote">"hasRole('ROLE_ADMIN')"</span>&#93;)
   def someAction() &#123;
      &#8230;
   &#125;<p class="paragraph"/>   @Secured(&#91;<span class="java&#45;quote">"authentication.name == 'ralph'"</span>&#93;)
   def someOtherAction() &#123;
      &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/>In this example, <code>someAction</code> requires <code>ROLE_ADMIN</code>, and <code>someOtherAction</code> requires that the user be logged in with username 'ralph'.<p class="paragraph"/>The corresponding <code>Requestmap</code> URLs would be<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Requestmap(url: <span class="java&#45;quote">"/secure/someAction"</span>,
               configAttribute: <span class="java&#45;quote">"hasRole('ROLE_ADMIN')"</span>).save()<p class="paragraph"/><span class="java&#45;keyword">new</span> Requestmap(url: <span class="java&#45;quote">"/secure/someOtherAction"</span>,
               configAttribute: <span class="java&#45;quote">"authentication.name == 'ralph'"</span>).save()</pre></div><p class="paragraph"/>and the corresponding static mappings would be<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.interceptUrlMap = &#91;
   '/secure/someAction':      &#91;<span class="java&#45;quote">"hasRole('ROLE_ADMIN')"</span>&#93;,
   '/secure/someOtherAction': &#91;<span class="java&#45;quote">"authentication.name == 'ralph'"</span>&#93;
&#93;</pre></div><p class="paragraph"/>The Spring Security docs have a <a href="https://docs.spring.io/spring-security/site/docs/3.2.x/reference/htmlsingle/#el-common-built-in" target="blank">table listing the standard expressions</a>, which is copied here for reference:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Expression</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td><code>hasRole(role)</code></td><td>Returns true if the current principal has the specified role.</td></tr><tr class="table-even"><td><code>hasAnyRole(&#91;role1,role2&#93;)</code></td><td>Returns true if the current principal has any of the supplied roles (given as a comma-separated list of strings)</td></tr><tr class="table-odd"><td><code>principal</code></td><td>Allows direct access to the principal object representing the current user</td></tr><tr class="table-even"><td><code>authentication</code></td><td>Allows direct access to the current Authentication object obtained from the SecurityContext</td></tr><tr class="table-odd"><td><code>permitAll</code></td><td>Always evaluates to true</td></tr><tr class="table-even"><td><code>denyAll</code></td><td>Always evaluates to false</td></tr><tr class="table-odd"><td><code>isAnonymous()</code></td><td>Returns true if the current principal is an anonymous user</td></tr><tr class="table-even"><td><code>isRememberMe()</code></td><td>Returns true if the current principal is a remember-me user</td></tr><tr class="table-odd"><td><code>isAuthenticated()</code></td><td>Returns true if the user is not anonymous</td></tr><tr class="table-even"><td><code>isFullyAuthenticated()</code></td><td>Returns true if the user is not an anonymous or a remember-me user</td></tr><tr class="table-odd"><td><code>request</code></td><td>the HTTP request, allowing expressions such as "isFullyAuthenticated() or request.getMethod().equals('OPTIONS')"</td></tr></table><p class="paragraph"/>In addition, you can use a web-specific expression <code>hasIpAddress</code>. However, you may find it more convenient to separate IP restrictions from role restrictions by using the <a href="../guide/single.html#ip" class="guide">IP address filter</a>.<p class="paragraph"/>To help you migrate traditional configurations to expressions, this table compares various configurations and their corresponding expressions:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Traditional Config</strong></th><th><strong class="bold">Expression</strong></th></tr><tr class="table-odd"><td><code>ROLE_ADMIN</code></td><td><code>hasRole('ROLE_ADMIN')</code></td></tr><tr class="table-even"><td><code>ROLE_USER,ROLE_ADMIN</code></td><td><code>hasAnyRole('ROLE_USER','ROLE_ADMIN')</code></td></tr><tr class="table-odd"><td><code>ROLE_ADMIN,IS_AUTHENTICATED_FULLY</code></td><td><code>hasRole('ROLE_ADMIN') and isFullyAuthenticated()</code></td></tr><tr class="table-even"><td><code>IS_AUTHENTICATED_ANONYMOUSLY</code></td><td><code>permitAll</code></td></tr><tr class="table-odd"><td><code>IS_AUTHENTICATED_REMEMBERED</code></td><td><code>isAuthenticated() or isRememberMe()</code></td></tr><tr class="table-even"><td><code>IS_AUTHENTICATED_FULLY</code></td><td><code>isFullyAuthenticated()</code></td></tr></table>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/domainClasses.html">&lt;&lt; <strong>3</strong><span>Domain Classes</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/helperClasses.html"><strong>5</strong><span>Helper Classes</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-create-persistent-token.html">s2-create-persistent-token</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-quickstart.html">s2-quickstart</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
