<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2 What's New in Version 2.0 2.0-RC6</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/newInV2.html"><strong>2</strong><span>What's New in Version 2.0</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClasses.html"><strong>3</strong><span>Domain Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/requestMappings.html"><strong>4</strong><span>Configuring Request Mappings to Secure URLs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/helperClasses.html"><strong>5</strong><span>Helper Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/events.html"><strong>6</strong><span>Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClassProperties.html"><strong>7</strong><span>User, Authority (Role), and Requestmap Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authentication.html"><strong>8</strong><span>Authentication</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authenticationProviders.html"><strong>9</strong><span>Authentication Providers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/userDetailsService.html"><strong>10</strong><span>Custom UserDetailsService</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/passwords.html"><strong>11</strong><span>Password and Account Protection</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/urlProperties.html"><strong>12</strong><span>URL Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/hierarchicalRoles.html"><strong>13</strong><span>Hierarchical Roles</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/switchUser.html"><strong>14</strong><span>Switch User</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/filters.html"><strong>15</strong><span>Filters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/channelSecurity.html"><strong>16</strong><span>Channel Security</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/ip.html"><strong>17</strong><span>IP Address Restrictions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/sessionFixation.html"><strong>18</strong><span>Session Fixation Prevention</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/logoutHandlers.html"><strong>19</strong><span>Logout Handlers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/voters.html"><strong>20</strong><span>Voters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/miscProperties.html"><strong>21</strong><span>Miscellaneous Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/tutorials.html"><strong>22</strong><span>Tutorials</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/controllerMetaClassMethods.html"><strong>23</strong><span>Controller MetaClass Methods</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/i18n.html"><strong>24</strong><span>Internationalization</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Spring Security Core plugin</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security Plugin</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/domainClasses.html"><strong>3</strong><span>Domain Classes</span> >></a></div>
                


                <div class="project">
                    <h1>2 What's New in Version 2.0 - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith, Beverley Talbott</p>

                    <p><strong>Version:</strong> 2.0-RC6</p>

                    
                </div>

                

                

<h1 id="newInV2">2 What's New in Version 2.0</h1>
There are many changes in the 2.x versions of the plugin from the older approaches in 1.x.<p class="paragraph"/>TODO role groups<p class="paragraph"/><h4>Package changes</h4><p class="paragraph"/>All classes are now in the <code>grails.plugin.springsecurity</code> package or a subpackage. The names tend to correspond to the analagous Spring Security classes where appropriate, for example <code>MutableLogoutFilter</code> is in the <code>grails.plugin.springsecurity.web.authentication.logout</code> package to correspond with the <code>org.springframework.security.web.authentication.logout</code> package.<p class="paragraph"/>Some of the changes were more subtle though; for example all classes in the old <code>grails.plugins.springsecurity</code> packages and subpackages are now in <code>grails.plugin.springsecurity</code>, only one character different. This will result in a non-trivial upgrade process for your applications, but that is a benefit as it will hopefully point you at other important changes you might have otherwise missed.<p class="paragraph"/><h4>Configuration prefix changes</h4><p class="paragraph"/>The prefix used in <code>Config.groovy</code> for the plugin's configuration settings has changed from <code>grails.plugins.springsecurity</code> to <code>grails.plugin.springsecurity</code>.<p class="paragraph"/><h4>More aggressively secure by default</h4><p class="paragraph"/>In 1.x it was assumed that defaulting pages to not be secured, and configuring guarded URLs as needed, was a more pragmatic approach. Now however, all URLs are initially blocked unless there is a request mapping rule, even if that rule allows all access. The assumption behind this change is that if you forget to guard a new URL, it can take a long time to discover that users had access, whereas if you forget to open access for allowed users when using the "pessimistic" approach, nobody can access the URL and the error will be quickly discovered. This approach is more work, but much safer.<p class="paragraph"/>This is described in more detail <a href="../guide/single.html#requestMappings" class="guide">here</a>.<p class="paragraph"/><h5>Logout POST only</h5><p class="paragraph"/>By default only POST requests are allowed to trigger a logout. To allow GET access, add this<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.logout.postOnly = <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><h5>bcrypt by default</h5><p class="paragraph"/>The default password hashing algorithm is now bcrypt since it is a very robust hashing approach. <a href="https://en.wikipedia.org/wiki/PBKDF2" target="blank">PBKDF2</a> is similar and is also supported. You  can still use any message digest algorithm that is supported in your JDK; see <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html" target="blank">this Java page</a> for the available algorithms.<p class="paragraph"/>New applications should use bcrypt or PBKDF2, but if you didn't change the default settings in previous versions of the plugin and want to continue using the same algorithm, use these settings:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.password.algorithm = 'SHA&#45;256'
grails.plugin.springsecurity.password.hash.iterations = 1</pre></div><p class="paragraph"/><h5>Session Fixation Prevention by default</h5><p class="paragraph"/>Session Fixation Prevention is now enabled by default, but can be disabled with<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.useSessionFixationPrevention = <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><h4>&#64;Secured annotation</h4><p class="paragraph"/>As of Grails 2.0, controller actions can be defined as closures or methods, with methods being preferred. The &#64;Secured annotation no longer supports being defined on controller action closures, so you will need to convert them to real methods.<p class="paragraph"/>You can also specify the HTTP method that an annotation is defined for (e.g. when using REST). When doing this you must explicitly name the <code>value</code> attribute, e.g.<p class="paragraph"/><div class="code"><pre>@Secured(value=&#91;<span class="java&#45;quote">"hasRole('ROLE_ADMIN')"</span>&#93;, httpMethod='POST')
def someMethod() &#123;
   &#8230;
&#125;</pre></div><p class="paragraph"/>In addition, you can define a closure in the annotation which will be called during access checking. The closure must return <code>true</code> or <code>false</code> and has all of the methods and properties that are available when using SpEL expressions, since the closure's <code>delegate</code> is set to a subclass of <code>WebSecurityExpressionRoot</code>, and also the Spring <code>ApplicationContext</code> as the <code>ctx</code> property:<p class="paragraph"/><div class="code"><pre>@Secured(closure = &#123;
   assert request
   assert ctx
   authentication.name == 'admin1'
&#125;)
def someMethod() &#123;
   &#8230;
&#125;</pre></div><p class="paragraph"/><h4>Anonymous authentication</h4><p class="paragraph"/>In standard Spring Security and older versions of the plugin, there is support for an "anonymous" authentication. This is implemented by a filter that registers a simple <code>Authentication</code> in the <code>SecurityContext</code> to remove the need for null checks, since there will always be an <code>Authentication</code> available. This approach is still problematic though because the Principal of the anonymous authentication is a String, whereas it is a <code>UserDetails</code> instance when there is a non-anonymous authentication.<p class="paragraph"/>Since you still have to be careful to differentiate between anonymous and non-anonymous authentications, the plugin now creates an anonymous <code>Authentication</code> which will be an instance of <code>grails.plugin.springsecurity.authentication. GrailsAnonymousAuthenticationToken</code> with a standard <code>org.springframework.security.core.userdetails.User</code> instance as its Principal. The authentication will have a single granted role, <code>ROLE_ANONYMOUS</code>.<p class="paragraph"/><h4>No HQL</h4><p class="paragraph"/>Some parts of the code used HQL queries, for example in the generated <code>UserRole</code> class and in <code>SpringSecurityService.findRequestmapsByRole</code>. These have been replaced  by "where" queries to make data access more portable across GORM implementatioins.<p class="paragraph"/><h4>Changes in generated classes</h4><p class="paragraph"/>The <code>enabled</code> property in the generated <code>User</code> class now defaults to <code>true</code>. This will make creating instances a bit more DRY:<p class="paragraph"/><div class="code"><pre>def u = <span class="java&#45;keyword">new</span> User(username: 'me', password: 'itsasecret').save()</pre></div><p class="paragraph"/>If you prefer the old approach, change your generated class.<p class="paragraph"/>Also, the plugin includes the <code>grails.plugin.springsecurity.LoginController.groovy</code> and <code>grails.plugin.springsecurity.LogoutController.groovy</code> controllers, and <code>grails-app/views/auth.gsp</code> and <code>grails-app/views/denied.gsp</code> GSPs. If you had no need previously to change these you can delete your files and the plugins' files will be used instead. If you do want to change them, copy each as needed to your application and make the required changes, and yours will be used instead.<p class="paragraph"/>One small change is that there is no longer a default value for the domain class name properties (<code>userLookup.userDomainClassName</code>, <code>authority.className</code>, <code>requestMap.className</code>, <code>rememberMe.persistentToken.domainClassName</code>). This was of little use and tended to cause confusing error messages when there was a misconfiguration.<p class="paragraph"/><h4>SecurityContextHolder strategy</h4><p class="paragraph"/>You can now define the <code>SecurityContextHolder</code> strategy. By default it is stored in a <code>ThreadLocal</code>, but you can also configure it to use an <code>InheritableThreadLocal</code> to maintain the context in new threads, or a custom class that implements the <code>org.springframework.security.core.context.SecurityContextHolderStrategy</code> interface. To change the strategy, set the <code>grails.plugin.springsecurity.sch.strategyName</code> config property to <code>"MODE_THREADLOCAL"</code> (the default) to use a <code>ThreadLocal</code>, <code>"MODE_INHERITABLETHREADLOCAL"</code> to use an <code>InheritableThreadLocal</code>, or the name of a class that implements <code>SecurityContextHolderStrategy</code>.<p class="paragraph"/><h4>Debug filter</h4><p class="paragraph"/>You can enable a "debug" filter based on the <code>org.springframework.security.config.debug.DebugFilter</code> class. It will log security information at the "info" level and can help when debugging configuration issues. This should only be enabled in development mode so consider adding the property that enables it inside an <code>environments</code> block in <code>Config.groovy</code><p class="paragraph"/><div class="code"><pre>environments &#123;
   development &#123;
      grails.logging.jul.usebridge = <span class="java&#45;keyword">true</span>
      grails.plugin.springsecurity.debug.useFilter = <span class="java&#45;keyword">true</span>
   &#125;
   production &#123;
      grails.logging.jul.usebridge = <span class="java&#45;keyword">false</span>
   &#125;
&#125;</pre></div><p class="paragraph"/>Also add the implementation class name in your Log4j configuration:<p class="paragraph"/><div class="code"><pre>info 'grails.plugin.springsecurity.web.filter.DebugFilter'</pre></div><p class="paragraph"/><h4>Storing usernames in the session</h4><p class="paragraph"/>In Spring Security 3.0 and earlier, the username was stored in the HTTP session under the key "SPRING_SECURITY_LAST_USERNAME". This no longer done, but the plugin will use the old behavior if the <code>grails.plugin.springsecurity.apf.storeLastUsername</code> setting is set to <code>true</code> (the default is <code>false</code> ). Further, the name is no longer escaped before storing, it is stored exactly as entered by the user, so you must escape it when redisplaying to avoid XSS attacks.<p class="paragraph"/><h4>&#64;Authorities annotation</h4><p class="paragraph"/>You can use the new &#64;Authorities annotation to make your annotations more DRY. See <a href="https://burtbeckwith.com/blog/?p=1398" target="blank">this blog post</a> for a description about the motivation and implementation details. Note that the package for the annotation in the plugin is <code>grails.plugin.springsecurity.annotation</code>, not <code>grails.plugins.springsecurity.annotation</code> as described in the blog post.<p class="paragraph"/><h4>Miscellaneous changes</h4><p class="paragraph"/><h5>AuthenticationDetailsSource</h5><p class="paragraph"/>Previously you could configure the details class that was constructed by the <code>authenticationDetailsSource</code> bean by setting the <code>authenticationDetails.authClass</code> property. In Spring Security 3.2 this isn't possible because <code>WebAuthenticationDetailsSource</code> always returns a <code>WebAuthenticationDetails</code>. But you can still customize the details class by creating a class that implements the <a href="https://docs.spring.io/spring-security/site/docs/3.2.x/apidocs/org/springframework/security/authentication/AuthenticationDetailsSource.html" target="blank">AuthenticationDetailsSource</a> interface, e.g.:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany;<p class="paragraph"/><span class="java&#45;keyword">import</span> javax.servlet.http.HttpServletRequest;<p class="paragraph"/><span class="java&#45;keyword">import</span> org.springframework.security.authentication.AuthenticationDetailsSource;<p class="paragraph"/><span class="java&#45;keyword">public</span> class MyAuthenticationDetailsSource <span class="java&#45;keyword">implements</span> AuthenticationDetailsSource&#60;HttpServletRequest, MyWebAuthenticationDetails&#62; &#123;<p class="paragraph"/>   <span class="java&#45;keyword">public</span> MyWebAuthenticationDetails buildDetails(HttpServletRequest context) &#123;
      // build a MyWebAuthenticationDetails
   &#125;
&#125;</pre></div><p class="paragraph"/>and registering that as the <code>authenticationDetailsSource</code> bean in <code>resources.groovy</code><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> com.mycompany.MyAuthenticationDetailsSource<p class="paragraph"/>beans = &#123;
   authenticationDetailsSource(MyAuthenticationDetailsSource) &#123;
      // any required properties
   &#125;
&#125;</pre></div>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security Plugin</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/domainClasses.html"><strong>3</strong><span>Domain Classes</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-create-persistent-token.html">s2-create-persistent-token</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-quickstart.html">s2-quickstart</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
